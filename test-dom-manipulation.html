<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DOM Manipulation Test</title>
    <style>
        .translation-target {
            border: 2px dashed #4CAF50 !important;
            background: rgba(76, 175, 80, 0.1) !important;
            position: relative !important;
        }
        .translation-target::after {
            content: "ğŸŒ";
            position: absolute;
            top: -8px;
            right: -8px;
            background: #4CAF50;
            color: white;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        .debug-info {
            background: #f0f0f0;
            padding: 10px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>DOM Manipulation Test</h1>
    
    <div class="debug-info" id="debugInfo">
        ë””ë²„ê¹… ì •ë³´ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...
    </div>
    
    <div class="instructions">
        <h3>ğŸ§ª How to Test the Extension</h3>
        <ol id="testList">
            <li>Load this extension in Firefox using <code>about:debugging</code></li>
            <li>Right-click anywhere on this page</li>
            <li>Select <strong>"ì´ í˜ì´ì§€ ë²ˆì—­í•˜ê¸°"</strong> from the context menu</li>
            <li>Open browser console (F12) to see detailed extraction results</li>
            <li>Check the console logs for priority classifications and extracted texts</li>
        </ol>
    </div>

    <button onclick="runTest()">í…ìŠ¤íŠ¸ ì¶”ì¶œ ë° í´ë˜ìŠ¤ ì¶”ê°€ í…ŒìŠ¤íŠ¸</button>
    <button onclick="clearClasses()">í´ë˜ìŠ¤ ì œê±°</button>

    <!-- TextExtractor ë¡œë“œ -->
    <script src="content/textExtractor.js"></script>
    
    <script>
        let textExtractor;
        
        function log(message) {
            const debugInfo = document.getElementById('debugInfo');
            debugInfo.textContent += message + '\n';
            console.log(message);
        }

        function clearLog() {
            document.getElementById('debugInfo').textContent = '';
        }

        function runTest() {
            clearLog();
            log('ğŸ”¥ í…ìŠ¤íŠ¸ ì¶”ì¶œ ë° DOM ì¡°ì‘ í…ŒìŠ¤íŠ¸ ì‹œì‘');
            
            try {
                // TextExtractor ì´ˆê¸°í™”
                if (!textExtractor) {
                    textExtractor = new TextExtractor();
                    log('âœ… TextExtractor ì´ˆê¸°í™” ì™„ë£Œ');
                }

                // 1. extractAllTexts í…ŒìŠ¤íŠ¸
                const allTexts = textExtractor.extractAllTexts();
                log(`ğŸ“Š extractAllTexts ê²°ê³¼: ${allTexts.length}ê°œ í…ìŠ¤íŠ¸`);
                
                if (allTexts.length === 0) {
                    log('âŒ ì¶”ì¶œëœ í…ìŠ¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤!');
                    return;
                }

                // 2. li ìš”ì†Œë“¤ í™•ì¸
                const liElements = document.querySelectorAll('ol li');
                log(`ğŸ” DOMì—ì„œ ë°œê²¬ëœ li ìš”ì†Œ: ${liElements.length}ê°œ`);

                // 3. ì²« 10ê°œ í…ìŠ¤íŠ¸ì— í´ë˜ìŠ¤ ì¶”ê°€ ì‹œë®¬ë ˆì´ì…˜
                log('\nğŸ¯ translation-target í´ë˜ìŠ¤ ì¶”ê°€ ì‹œì‘:');
                
                let addedCount = 0;
                allTexts.slice(0, 10).forEach((textInfo, index) => {
                    if (textInfo.element) {
                        try {
                            textInfo.element.classList.add('translation-target');
                            log(`  ${index + 1}. [${textInfo.tagName}] í´ë˜ìŠ¤ ì¶”ê°€ ì„±ê³µ: "${textInfo.text.substring(0, 50)}..."`);
                            addedCount++;
                        } catch (error) {
                            log(`  ${index + 1}. [${textInfo.tagName}] í´ë˜ìŠ¤ ì¶”ê°€ ì‹¤íŒ¨: ${error.message}`);
                        }
                    } else {
                        log(`  ${index + 1}. [${textInfo.tagName}] elementê°€ nullì…ë‹ˆë‹¤!`);
                    }
                });

                log(`\nâœ… ì´ ${addedCount}ê°œ ìš”ì†Œì— translation-target í´ë˜ìŠ¤ ì¶”ê°€ ì™„ë£Œ`);

                // 4. ì‹¤ì œë¡œ í´ë˜ìŠ¤ê°€ ì¶”ê°€ë˜ì—ˆëŠ”ì§€ í™•ì¸
                const targetElements = document.querySelectorAll('.translation-target');
                log(`ğŸ” .translation-target í´ë˜ìŠ¤ë¥¼ ê°€ì§„ ìš”ì†Œ: ${targetElements.length}ê°œ`);

                // 5. li ìš”ì†Œë“¤ì´ ì œëŒ€ë¡œ í¬í•¨ë˜ì—ˆëŠ”ì§€ í™•ì¸
                const targetLiElements = document.querySelectorAll('li.translation-target');
                log(`ğŸ“ .translation-target í´ë˜ìŠ¤ë¥¼ ê°€ì§„ li ìš”ì†Œ: ${targetLiElements.length}ê°œ`);

                if (targetLiElements.length > 0) {
                    log('ğŸ‰ li ìš”ì†Œë“¤ì— ì„±ê³µì ìœ¼ë¡œ í´ë˜ìŠ¤ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!');
                } else {
                    log('âš ï¸ li ìš”ì†Œë“¤ì— í´ë˜ìŠ¤ê°€ ì¶”ê°€ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                    
                    // ì¶”ê°€ ë””ë²„ê¹…: ì¶”ì¶œëœ í…ìŠ¤íŠ¸ ì¤‘ LI ìš”ì†Œë“¤ í™•ì¸
                    const liTexts = allTexts.filter(t => t.tagName === 'LI');
                    log(`\nì¶”ì¶œëœ LI í…ìŠ¤íŠ¸: ${liTexts.length}ê°œ`);
                    liTexts.forEach((textInfo, i) => {
                        log(`  ${i+1}. "${textInfo.text}" - element: ${textInfo.element ? textInfo.element.tagName : 'null'}`);
                    });
                }

            } catch (error) {
                log(`âŒ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜: ${error.message}`);
                console.error(error);
            }
        }

        function clearClasses() {
            document.querySelectorAll('.translation-target').forEach(el => {
                el.classList.remove('translation-target');
            });
            log('ğŸ§¹ ëª¨ë“  translation-target í´ë˜ìŠ¤ ì œê±° ì™„ë£Œ');
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì‹¤í–‰
        window.addEventListener('load', function() {
            setTimeout(runTest, 500);
        });
    </script>
</body>
</html>